<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title></title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <meta property="og:site_name" content="BTV Pokemap"/>
    <meta property="og:title" content="BTV Pokemap"/>
    <meta property="og:description" content="Find and add pokestops around Burlington, VT"/>
    <meta property="og:image" content="preview.png">
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.22.0/mapbox-gl.css' rel='stylesheet' />
    <link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.5/paper/bootstrap.min.css" rel="stylesheet">
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
        #content {
          border-top: solid 1px #333;
          position:absolute;
          left:0;
          right:0;
          min-height:100px;
          bottom:0;
          background:RGBA(214, 255, 200, 0.9);
        }
          .sidecontainer {
          padding:20px;
        }
    </style>
</head>
<body>

<style>
.marker {
    display: block;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    padding: 0;
    background-color:rgba(0,0,0,0);
}
</style>

<div id='map'></div>
<div id='content'>
  <div class="sidecontainer">
    <div class="row">
      
      <div class="col-md-10"><h4>Pokestops around Burlington, VT</h4><p><small>(Many thanks to <a href="http://www.burlingtonfreepress.com/" target="_blank">The Burlington Free Press</a> & <a href="https://twitter.com/asuozzo" target="_blank">Andrea Suozzo</a>)</small></p></div>
      <div class="col-md-2"><a class="btn btn-primary btn-lg" target="_blank" href="add/">Add more!</a></div>
    </div>    
  </div>
</div>
<script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.22.0/mapbox-gl.js'></script>
<script src='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js'></script>

<script>
mapboxgl.accessToken = 'pk.eyJ1IjoibGFuZHBsYW5uZXIiLCJhIjoicUtlZGgwYyJ9.UFYz8MD4lI4kIzk9bjGFvg';
$.getJSON("https://spreadsheets.google.com/feeds/list/1IiRzXl5QMbEL7T2GEtOJ8TM9N6iHnlVsajH36lWkInI/1/public/values?alt=json", function(data) {
  // create the geojson in question
  var stops = data.feed.entry;
  var pokeGeojson = {type: 'FeatureCollection', features: []};

  for (var i in stops) {
    if (stops[i].gsx$latitude.$t) {
      var feature = {
        type: 'Feature',
        properties: {
          name: '<h1>' + stops[i].gsx$name.$t + '</h1>'
        },
        geometry: {
          type: 'Point',
          coordinates: [stops[i].gsx$longitude.$t, stops[i].gsx$latitude.$t]
        }
      };
      pokeGeojson.features.push(feature);
    }
  }
  
  // define the map and add the stops
  var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/landplanner/cirpalue40023guno4nmgz6xd',
    center: [-73.2131, 44.4772],
    zoom: 16.5,
    bearing: 267,
    pitch: 60
  });

  // add markers to map
  pokeGeojson.features.forEach(function(marker) {
    // create an img element for the marker
    var el = document.createElement('button');
    el.className = 'marker';
    el.style.backgroundImage = 'url(img/pokestop_small2.png)';
    el.style.width = '50px';
    el.style.height = '50px';

    el.addEventListener('click', function() {
      console.log(marker.geometry.coordinates);
      map.flyTo({center: marker.geometry.coordinates});
    });

    // add marker to map
    new mapboxgl.Marker(el)
      .setLngLat(marker.geometry.coordinates)
      .addTo(map);
  });
  map.addControl(new mapboxgl.Navigation());
})
</script>

</body>
</html>
